<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>个人资料</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="/resources/layui/css/layui.css" media="all" />
	<link rel="stylesheet" href="/resources/css/public.css" media="all" />
</head>
<body class="childrenBody">
<form class="layui-form layui-row" lay-filter="dataForm" id="dataForm">
	<div class="layui-col-md3 layui-col-xs12 user_right">
		<div class="layui-upload-list">
		
		    <!-- 隐藏的用户图片路径 -->
		    <input type="hidden" id="userimgpath" name="userimgpath">
			<img class="layui-upload-img layui-circle userFaceBtn userAvatar" id="userFace">
			
		</div>
		<button type="button" class="layui-btn layui-btn-primary userFaceBtn"><i class="layui-icon">&#xe67c;</i> 掐指一算，我要换一个头像了</button>
		<!-- <p>由于是纯静态页面，所以只能显示一张随机的图片</p> -->
	</div>
	
	<div class="layui-col-md6 layui-col-xs12">
		<div class="layui-form-item">
			<label class="layui-form-label">用户名</label>
			<div class="layui-input-block">
			    <!--隐藏的用户id  -->
			    <input type="hidden"  name="id">
				<input type="text" name="loginname" value="" disabled class="layui-input layui-disabled">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">用户组</label>
			<div class="layui-input-block">
			    <!-- 用户所在部门 -->
				<input type="text" name="deptname" value="" disabled class="layui-input layui-disabled">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">登录名</label>
			<div class="layui-input-block">
				<input type="text" name="loginname" value="" placeholder="请输入登录名" lay-verify="required" class="layui-input">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">真实姓名</label>
			<div class="layui-input-block">
				<input type="text" name="name" value="" placeholder="请输入真实姓名" lay-verify="required" class="layui-input realName">
			</div>
		</div>
		<div class="layui-form-item" pane="">
			<label class="layui-form-label">性别</label>
			<div class="layui-input-block userSex">
				<input type="radio" name="sex" value="1" title="男" checked="">
				<input type="radio" name="sex" value="0" title="女">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">手机号码</label>
			<div class="layui-input-block">
				<input type="tel" name="telephone" value="" placeholder="请输入手机号码"  class="layui-input userPhone">
			</div>
		</div>
	<!-- 	<div class="layui-form-item">
			<label class="layui-form-label">出生年月</label>
			<div class="layui-input-block">     //lay-verify="userBirthday" 
			
				<input type="tel" name="birthday" id="birthday" placeholder="请输入出生年月"  autocomplete="off" class="layui-input">
			</div>
		</div> -->
<!-- 		<div class="layui-form-item userAddress">
			<label class="layui-form-label">家庭住址</label>
			<div class="layui-input-inline">
				<select name="province" lay-filter="province" class="province" id="province_select">
					<option value="">请选择省</option>
				</select>
			</div>
			<div class="layui-input-inline">
				<select name="city" lay-filter="city" disabled id="city_select">
					<option value="">请选择市</option>
				</select>
			</div>
			<div class="layui-input-inline">
				<select name="area" lay-filter="area" disabled id="area_select">
					<option value="">请选择县/区</option>
				</select>
			</div>
		</div> -->
		
		<div class="layui-form-item">
			<label class="layui-form-label">详细地址</label>
			<div class="layui-input-block ">
			    <input type="text" name="address" value="" placeholder="请输入详细地址" class="layui-input">
			</div>
		</div>	
		
		
		<div class="layui-form-item">
			<label class="layui-form-label">使用技术</label>
			<div class="layui-input-block" id="technology_checkbox">
			  <!--   <input type="checkbox" name="tids" value="6" title="springboot">
				<input type="checkbox" name="tids" value="21" title="基本ssm">
				<input type="checkbox" name="tids" value="5"  title="mybatis-plus">
				<input type="checkbox" name="tids" value="4" title="通用mapper">
				<input type="checkbox" name="tids" value="22"  title="thmeleaf">
				<input type="checkbox" name="tids" value="23" title="jsp">
				<input type="checkbox" name="tids" value="8" title="shiro">
				<input type="checkbox" name="tids" value="9" title="spring-security">
				<input type="checkbox" name="tids" value="11" title="Quartz">
				<input type="checkbox" name="tids" value="14" title="activity">
				<input type="checkbox" name="tids" value="18" title="zxing">
				<input type="checkbox" name="tids" value="17" title="poi">
				<input type="checkbox" name="tids" value="15" title="echarts">
				<input type="checkbox" name="tids" value="16" title="hightcharts">
				<input type="checkbox" name="tids" value="20" title="druid">
				<input type="checkbox" name="tids" value="12" title="layui">
				<input type="checkbox" name="tids" value="13" title="easyui"> -->
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">邮箱</label>
			<div class="layui-input-block">
				<input type="text" name="email" value="" placeholder="请输入邮箱" lay-verify="email" class="layui-input userEmail">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">自我评价</label>
			<div class="layui-input-block">
				<textarea placeholder="请输入内容" name="remark" class="layui-textarea myself"></textarea>
			</div>
		</div>
		<div class="layui-form-item">
			<div class="layui-input-block">
				<button class="layui-btn" lay-submit="" lay-filter="doSubmit">立即提交</button>
				<button type="reset" class="layui-btn layui-btn-primary">重置</button>
			</div>
		</div>
	</div>
</form>
<script type="text/javascript" src="/resources/layui/layui.js"></script>
<script type="text/javascript">
var form, $,areaData;
layui.config({
    base : "/resources/js/"
}).extend({
    "address" : "address"
})
layui.use(['form','layer','jquery','upload','laydate',"address"],function(){
       var $ = layui.jquery;	   
	   var form = layui.form;	  
	   var layer = layui.layer;
	   var address = layui.address;
	   var upload = layui.upload;
	   var laydate = layui.laydate;
	   
	   //用themeleaf的方式获取session域的数据
	   var userid= [[${session.user.id}]];
	   
	   var user;
	   
	    //获取省信息
	  //  address.provinces();
	  //  address.citys();
	  //  address.areas();
	    
	   
	   //页面加载成功查询当前登录用户的数据
	   $.get("/user/queryUserInfo?id="+userid,function(rtn){		   
		  user = rtn.data;		   
		  //回显数据
           form.val("dataForm",user);		  
		  //设置回显用户头像图片
          $("#userFace").attr("src","/file/downloadShowFile?path="+user.userimgpath);
		  
		  //回显用户图片路径
		  $("#userimgpath").val(user.userimgpath);
		  
		  //发起ajax请求来查询全部技术
		  $.get("/technology/queryAllTechnologyForList",function(rtn){
			   var list = rtn.data;
			   var tids = user.tids;
			   var input = '';
			   
			   //打开前先清空，防止有多余的
			   $("#technology_checkbox").html('');	
			   
			   $.each(list,function(index,ele){						   
				   input = '<input type="checkbox"  name="tids" value="'+ele.id+'" title="'+ele.name+'">';						   					   
				   for(var i=0;i<tids.length;i++) {					   					   
					   if(ele.id == tids[i]){						  
						   input = '<input type="checkbox" checked="checked" name="tids" value="'+ele.id+'" title="'+ele.name+'">';				            
					   }
				   }
				   //用追加来做
				   $("#technology_checkbox").append(input);	
			   })				   
			   //console.log(input);			   
			  	   
			   //记得重新渲染
			   form.render();
			   
			   
			
		  })
		 
	   })
	   
	 /*     //生日
	    laydate.render({
		   	elem: '#birthday',
		   	type:'date',
		   	value:''
   		 }); */
    
	
	   
	   //普通图片上传
        //渲染文件上传
        var uploadInst = upload.render({
            elem: '.userFaceBtn'
            ,url: '/file/uploadFile'
            ,accept:'images'
            ,acceptMime:'image/*'
            ,field:'mf'
            ,done: function(res, index, upload){
                  //上传成功回调，去下载图片来显示查看
                  $("#userFace").attr("src","/file/downloadShowFile?path="+res.data.src);
                  //把传到数据库的隐藏input赋值
                  $("#userimgpath").val(res.data.src);

                  $('#uploadImgDiv').css("background","#fff");
            }
        });


    //添加验证规则
    form.verify({
        userBirthday : function(value){
            if(!/^(\d{4})[\u4e00-\u9fa5]|[-\/](\d{1}|0\d{1}|1[0-2])([\u4e00-\u9fa5]|[-\/](\d{1}|0\d{1}|[1-2][0-9]|3[0-1]))*$/.test(value)){
                return "出生日期格式不正确！";
            }
        }
    })
    
    //选择出生日期
   /*  laydate.render({
        elem: '.userBirthday',
        trigger: 'click',
        max : 0,
        mark : {"0-12-15":"生日"},
        done: function(value, date){
            if(date.month === 12 && date.date === 15){ //点击每年12月15日，弹出提示语
                layer.msg('今天是马哥的生日，也是layuicms2.0的发布日，快来送上祝福吧！');
            }
        }
    }); */
    
    
   
  
    
    
    
  
    
    /*监听提交方法*/   //提交个人资料
    form.on('submit(doSubmit)', function(data){
 
    	
    	 var index = layer.msg('提交中，请稍候',{icon: 16,time:false,shade:0.8});
         setTimeout(function(){     
        	 
        	   /*把表单数据提交*/
             var params = $("#dataForm").serialize();
       	
    	  	 console.log(params);
    	  	 var url = '/user/updateUserInfo';
    	       //ajax提交
              $.post(url,params,function(rtn) {
                      //弹出操作成功与否的提示
                      layer.msg(rtn.msg);
                    
              })  
             //这个关闭那个提交中的弹出层
             layer.close(index);            
         },2000); 
         return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。      
    });

})
</script>

</body>
</html>